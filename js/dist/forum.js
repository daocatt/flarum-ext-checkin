(()=>{var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e),t.d(e,{extend:()=>K});const n=flarum.core.compat["forum/app"];var a=t.n(n);flarum.core.compat.extend,flarum.core.compat["components/Button"],flarum.core.compat["common/components/Alert"];const o=flarum.core.compat.Model;var c=t.n(o);const i=flarum.core.compat["models/User"];var r=t.n(i);const s=flarum.core.compat["common/extend"],u=flarum.core.compat["forum/components/IndexPage"];var l=t.n(u);function d(t,e){return d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},d(t,e)}function p(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,d(t,e)}const f=flarum.core.compat["common/Component"];var h=t.n(f);const y=flarum.core.compat["common/components/Button"];var k=t.n(y),v=function(t){function e(){return t.apply(this,arguments)||this}p(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.state=this.attrs.state},n.view=function(){var t=this.state,e=a().translator.trans("gtdxyz-checkin.forum.checkin"),n=a().session.user.attribute("checkin_days_count");return"enabled"===t?k().component({icon:"far fa-check-circle",className:"Button CheckinButton CheckinButton--active",id:"checkinButton",onclick:a().checkinClick},e):(e=a().translator.trans("gtdxyz-checkin.forum.checked-days",{count:n}),k().component({icon:"fas fa-check-square",className:"Button CheckinButton CheckinButton--checked",disabled:!0},e))},e}(h());const N=flarum.core.compat["forum/components/HeaderSecondary"];var b=t.n(N);const g=flarum.core.compat["forum/components/NotificationsDropdown"];var x=t.n(g);const C=flarum.core.compat["common/components/LoadingIndicator"];var w=t.n(C);const M=flarum.core.compat["common/helpers/icon"];var _=t.n(M),j=function(t){function e(){return t.apply(this,arguments)||this}p(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.state=this.attrs.state},n.getWeekdays=function(){var t,e=dayjs().day();0===e&&(e=7),t=dayjs().subtract(e-1,"day");var n=[];n.push(t.format("YYYY-MM-DD"));for(var a=1;a<=7;)n.push(t.add(a,"day").format("YYYY-MM-DD")),a++;return n},n.view=function(){var t=this.state.cache||[],e=a().session.user.attribute("allowCheckin"),n=this.getWeekdays();return m("div",{className:"NotificationList CheckinList"},m("div",{className:"NotificationList-header"},m("h4",{className:"App-titleControl App-titleControl--text"},a().translator.trans("gtdxyz-checkin.forum.reward-text"))),m("div",{className:"NotificationList-content"},m("ul",{className:"NotificationGroup-content"},t.length>0?t.map((function(e,a){var o=e.id()>0?"checked":"uncheck";return m("li",{className:o+" count-"+t.length,title:o},e.id()>0?m("view",null,m("div",{className:"Notification-content"},m("span",null,dayjs(e.checkin_time()).format("MM/DD")),m("span",null,dayjs(e.checkin_time()).format("ddd"))),m("div",{className:"Notification-excerpt"},_()("fas fa-star",{className:"Notification-icon"}))):m("view",null,m("div",{className:"Notification-content"},m("span",null,dayjs(n[a]).format("MM/DD")),m("span",null,dayjs(n[a]).format("ddd"))),m("div",{className:"Notification-excerpt"},dayjs().isAfter(n[a],"day")?_()("fas fa-minus",{className:"Notification-icon"}):_()("far fa-star",{className:"Notification-icon"}))))})):this.state.loading?m(w(),{className:"LoadingIndicator--block"}):m("div",{className:"NotificationList-empty"},a().translator.trans("gtdxyz-checkin.forum.empty-text"))),m("div",{className:"subtitle"},a().translator.trans("gtdxyz-checkin.forum.count-text",{count:a().session.user.attribute("checkin_days_count")})," ",m("br",null),1===a().forum.attribute("checkinConstantForce")&&a().translator.trans("gtdxyz-checkin.forum.constant-recent-count-text",{count:a().session.user.attribute("checkin_constant_count")})),m("div",{className:"Form-group"},e?m(v,{state:"enabled"}):m(v,{state:"disabled"}))))},e}(h()),Y=function(t){function e(){return t.apply(this,arguments)||this}p(e,t),e.initAttrs=function(e){e.label=e.label||a().translator.trans("gtdxyz-checkin.forum.checkin"),e.icon=e.icon||"fas fa-calendar-alt",e.menuClassName="forum-checkin",t.initAttrs.call(this,e)};var n=e.prototype;return n.getMenu=function(){return m("div",{className:"Dropdown-menu "+this.attrs.menuClassName,onclick:this.menuClick.bind(this)},this.showing&&m(j,{state:this.attrs.state}))},n.goToRoute=function(){m.route.set(a().route("UserCheckinRoute",{username:a().session.user.username()}))},n.getUnreadCount=function(){return 0},n.getNewCount=function(){return 0},e}(x());const z=flarum.core.compat["components/Page"];var D=t.n(z);const T=flarum.core.compat.Component;var S=t.n(T);const L=flarum.core.compat.app;var O=t.n(L);const A=flarum.core.compat["components/LoadingIndicator"];var B=t.n(A),P=function(t){function e(){return t.apply(this,arguments)||this}p(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.state=this.attrs.state},n.getWeekdays=function(){var t,e=dayjs().day();0===e&&(e=7),t=dayjs().subtract(e-1,"day");var n=[];n.push(t.format("YYYY-MM-DD"));for(var a=1;a<=7;)n.push(t.add(a,"day").format("YYYY-MM-DD")),a++;return n},n.view=function(){var t=this.state.cache||[];if(O().session.user){var e=O().session.user.attribute("allowCheckin"),n=this.getWeekdays();return m("div",{className:"Checkin-page NotificationList CheckinList"},m("div",{className:"NotificationList-header"},m("h4",{className:"App-titleControl App-titleControl--text"},O().translator.trans("gtdxyz-checkin.forum.checkin"))),m("div",{className:"NotificationList-content"},m("ul",{className:"NotificationGroup-content"},t.length>0?t.map((function(e,a){var o=e.id()>0?"checked":"uncheck";return m("li",{className:o+" count-"+t.length,title:o},e.id()>0?m("view",null,m("div",{className:"Notification-content"},m("span",null,dayjs(e.checkin_time()).format("MM/DD")),m("span",null,dayjs(e.checkin_time()).format("ddd"))),m("div",{className:"Notification-excerpt"},_()("fas fa-star",{className:"Notification-icon"}))):m("view",null,m("div",{className:"Notification-content"},m("span",null,dayjs(n[a]).format("MM/DD")),m("span",null,dayjs(n[a]).format("ddd"))),m("div",{className:"Notification-excerpt"},dayjs().isAfter(n[a],"day")?_()("fas fa-minus",{className:"Notification-icon"}):_()("far fa-star",{className:"Notification-icon"}))))})):this.loading?m(B(),{className:"LoadingIndicator--block"}):m("div",{className:"NotificationList-empty"},O().translator.trans("gtdxyz-checkin.forum.empty-text"))),m("div",{className:"subtitle"},O().translator.trans("gtdxyz-checkin.forum.count-text",{count:O().session.user.attribute("checkin_days_count")})," ",m("br",null),1===O().forum.attribute("checkinConstantForce")&&O().translator.trans("gtdxyz-checkin.forum.constant-recent-count-text",{count:O().session.user.attribute("checkin_constant_count")})),m("div",{className:"Form-group"},e?m(v,{state:"enabled"}):m(v,{state:"disabled"}))))}},e}(S()),R=function(t){function e(){return t.apply(this,arguments)||this}p(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),a().history.push("UserCheckinRoute"),a().checkins.load()},n.oncreate=function(e){t.prototype.oncreate.call(this,e),a().setTitle(a().translator.trans("gtdxyz-checkin.forum.checkin"))},n.view=function(){return m("div",null,m(P,{state:a().checkins}))},e}(D());const I=flarum.core.compat["components/Modal"];var U=t.n(I);flarum.core.compat["utils/Stream"];var F=function(t){function e(){return t.apply(this,arguments)||this}p(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e)},n.className=function(){return"CheckinModal Modal--small"},n.title=function(){return m("div",{className:"successTitle"},app.translator.trans("gtdxyz-checkin.forum.success"))},n.content=function(){var t=app.session.user.attribute("checkin_days_count"),e=app.forum.attribute("checkinReward"),n=app.forum.attribute("checkinSuccessText"),a=app.forum.attribute("checkinSuccessRewardText"),o="",c="CheckinModal hideText",i="CheckinModal hideText";return""!==n&&(c="CheckinModal successText"),!0==(void 0!==app.forum.attribute("gtdxyz-money-plus.moneyname"))&&""!==a&&(o=e+(app.forum.attribute("gtdxyz-money-plus.moneyname")||"MO"),i="CheckinModal rewardText"),m("div",{className:"Modal-body"},m("div",{className:c},n.replace("[days]",t+1)),m("div",{className:i},a.replace("[reward]",o)))},e}(U()),W=function(t){function e(){return t.apply(this,arguments)||this}p(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e)},n.className=function(){return"CheckinModal Modal--small"},n.title=function(){return m("div",{className:"failedTitle"},app.translator.trans("gtdxyz-checkin.forum.failed"))},n.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"modalText"},app.translator.trans("gtdxyz-checkin.forum.try-again-later")))},e}(U());const G=flarum.core.compat["common/Model"];var H=t.n(G),q=function(t){function e(){return t.apply(this,arguments)||this}return p(e,t),e}(H());Object.assign(q.prototype,{user_id:H().attribute("user_id"),type:H().attribute("type"),event_id:H().attribute("event_id"),checkin_time:H().attribute("checkin_time"),reward_money:H().attribute("reward_money"),constant:H().attribute("constant"),remark:H().attribute("remark"),user:H().hasOne("user")});var J=function(){function t(t){this.app=t,this.loading=!1}return t.prototype.load=function(){var t=this;this.cache&&this.app.session.user.attribute("checkin_sync")&&dayjs(this.app.session.user.attribute("checkin_sync")).isSame(dayjs().format("YYYY-MM-DD"),"day")||(this.loading=!0,m.redraw(),this.app.store.find("checkin/history").then((function(e){t.app.session.user.pushAttributes({checkin_sync:dayjs().format("YYYY-MM-DD")}),t.cache=e})).catch((function(){})).then((function(){t.loading=!1,m.redraw()})))},t}();const E=flarum.core.compat["common/extenders"],K=[(new(t.n(E)().Store)).add("checkins",q)];a().initializers.add("gtdxyz-checkin",(function(){a().store.models.UserCheckinHistory=q,a().routes.UserCheckinRoute={path:"/u/:username/checkin/history",component:R},a().checkins=new J(a()),r().prototype.canCheckin=c().attribute("allowCheckin"),a().checkinClick=function(){var t=a().session.user.attribute("checkin_days_count"),e=a().forum.attribute("checkinReward"),n=a().forum.attribute("checkinSuccessType"),o=a().forum.attribute("checkinSuccessText"),c=a().forum.attribute("checkinSuccessRewardText"),i=void 0!==a().forum.attribute("gtdxyz-money-plus.moneyname"),r="";!0===i&&(r=a().forum.attribute("gtdxyz-money-plus.moneyname")||"MO");var s=a().translator.trans("gtdxyz-checkin.forum.failed")+" "+a().translator.trans("gtdxyz-checkin.forum.try-again-later");a().session.user.save({allowCheckin:!1,checkin_days_count:t+1}).then((function(){if(1===n){var s="";if(""!==o){var u=o.replace("[days]",t+1);a().alerts.show({type:"success"},u)}if(!0===i&&""!==c){s=e+r;var m=c.replace("[reward]",s);a().alerts.show({type:"success"},m)}}else 2===n&&a().modal.show(F)})).catch((function(t){var e,o=JSON.parse(t.xhr.response).errors;o.length>0&&(s=null==(e=o[0])?void 0:e.detail),1===n&&a().alerts.show({type:"error"},s),2===n&&a().modal.show(W)}))},(0,s.extend)(l().prototype,"sidebarItems",(function(t){var e="forum-checkin";1!==app.forum.attribute("checkinPosition")&&null!==app.session.user&&!0===app.forum.attribute("allowCheckin")&&(!0===app.session.user.attribute("allowCheckin")?t.add(e,m(v,{state:"enabled"}),50):t.add(e,m(v,{state:"disabled"}),50))})),(0,s.extend)(b().prototype,"items",(function(t){1===a().forum.attribute("checkinPosition")&&null!==a().session.user&&!0===a().forum.attribute("allowCheckin")&&t.add("checkin",m(Y,{state:a().checkins}),20)}))}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map